<!DOCTYPE html> <html>
<head> 

<style>
#console {
    background-color: #F5F5F5;
	border: 5px solid #8e9baf;
    display: inline-block;
	height: 200px;
    width: 100%;
    overflow: auto;
    background-color: #eeeeee;
	text-align: left;
	padding-left: 3px;
	font-size: 125%;
}
    #leaderboard {
        background-color: #F5F5F5;
        border: 5px solid #8e9baf;
        display: inline-block;
        height: 200px;
        width: 100%;
        overflow: auto;
        background-color: #eeeeee;
        text-align: left;
        padding-left: 3px;
        font-size: 125%;
    }
</style>

<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
    
<script>
//link https://firebase.google.com/docs/reference/js/firebase.database.DataSnapshot#forEach    
//link for android studio: http://gamecodeschool.com/android/coding-a-breakout-game-for-android/
    
 var config = {
    apiKey: "AIzaSyCZjt0SMXe12qPYjxIPRXMqw4LGXCcy37w",
    authDomain: "platform-c316b.firebaseio.com/.firebaseapp.com",
    databaseURL: "https://platform-c316b.firebaseio.com/",
    storageBucket: "platform-c316b.appspot.com"
  };
firebase.initializeApp(config);

// Get a reference to the database service
var database = firebase.database();
    
    
var leaderboard = database.ref().child("Leaderboard");    
//var childMap = {};
//var childArr = [];
//var peopleL = 0;

class WorldRefer {
    constructor(num) {
        this.ref = leaderboard.child("World" + num);
        this.childMap = {};
        this.childArr = [];
        this.people = 0;
    }
}
    
var worldObjArr = [];    
    
function data(num) {
    var worldObj;
    //console.log(num);
    if (worldObjArr.length != num) {
        //there isnt a worldObj in the worldObjArr
        worldObj = new WorldRefer(num);
        worldObjArr[num-1] = worldObj;
    } else {
        //get it from the array
        worldObj = worldObjArr[num-1];
    }
    
    printlnLeaderboard("Leaderboard of World " + num + ": ", "green");
    var refer = worldObj.ref;
    var cArr = worldObj.childArr;
    var cMap = worldObj.childMap;
    refer.once("value")
        .then(function(snapshot) {
            snapshot.forEach(function(childSnapShot) {
                var key = childSnapShot.key;
                var childData = childSnapShot.val();
                
                //console.log(key + " " + childData);
                if (cArr.indexOf(childData) != -1) {
                    //already exists
                    cMap[childData].push(key);
                } else {
                    cArr.push(childData);
                    //console.log(childArr.length);
                    cMap[childData] = new Array();
                    cMap[childData].push(key);
                }
                worldObj.people++;
                //console.log(peopleL);
            });
            
            printLeaderboard(worldObj);
        });
        
}    

function printLeaderboard(worldObj) {
    var counter = 0;
    //console.log(childArr.length);
    worldObj.childArr.sort(function(a, b){return b - a});
    for (var i = 0; i < worldObj.childArr.length; i++) {
        var arr = worldObj.childMap[worldObj.childArr[i]];
       // console.log(arr.length);
        for (var j = 0; j < arr.length; j++) {
            printlnLeaderboard("  " + (counter + 1 ) + ". " + arr[j] + " " + worldObj.childArr[i]);
            //console.log(i + " " + j);
            counter++;
        }
    }
}
    
function addToLeaderboard(n, p, num) {
    var worldObj = worldObjArr[num-1];
    if (worldObj.people > 4) {
        //delete last person
        worldObj.childArr.sort(function(a, b){return b-a});
        //greatest to least
        var lastScore = worldObj.childArr[worldObj.childArr.length-1];
        var lastPerson = worldObj.childMap[lastScore][0];
        //var worldRef = leaderboard.ref().child("World" + worldNum);
        worldObj.ref.once("value")
            .then(function(snapshot) {
                snapshot.forEach(function (childSnapshot) {
                    var key = childSnapshot.key;
                    var val = childSnapshot.val();
                    if (key == lastPerson && lastScore == val) {
                        worldObj.ref.child(lastPerson).remove();
                        
                    }
                });
            });
        //remove from array
        if (worldObj.childMap[lastScore].length == 1) {
            //only one instance of the score
            worldObj.childArr.splice(worldObj.childArr.length-1, 1);
        } else {
            //remove first (oldest) score
            worldObj.childMap[lastScore].splice(0, 1);
        }
    }
    
    var updates = {};
    updates['/Leaderboard/World' + worldNum + '/' + n] = p;
    database.ref().update(updates);

    if (worldObj.childArr.indexOf(p) != -1) {
        //already exists
        worldObj.childMap[p].push(n);
    } else {
        worldObj.childArr.push(p);
        //console.log(childArr.length);
        worldObj.childMap[p] = new Array();
        worldObj.childMap[p].push(n);
    }

    printlnLeaderboard("");
    printlnLeaderboard("");
    printlnLeaderboard("NEW Leaderboard of World " + num + ": ", "red");

    worldObj.people++;
    printLeaderboard(worldObj);
}
    
    
    
    
    
    
    
//http://www.somethinghitme.com/2013/01/09/creating-a-canvas-platformer-tutorial-part-one/
//for chatroom server: https://vijayannadi.wordpress.com/tutorials/sample-chat-app-using-nodejs-socketio/
//another link: http://psitsmike.com/2011/10/node-js-and-socket-io-multiroom-chat-tutorial/
var up = 1;
var down = 2;
var left = 3;
var right = 4;

var points = 0;    

var xDir;
var yDir;

var dx = 5;
var dy = 20;

var startM = 0;
var endM = 12;
var countSpeed = 0;

var worldNum = 1;
    
var worldCreator = ["Jacob Zhang", "Evan Yang", "Jacob Zhang", "Jacob Zhang", "Jacob Zhang"];
    /*
        Key: 
            7 - finish
            4 - spike
            1 - regular block
            3 - troll block (air block)
            6 - coin
            9 - enemy
            2 - invisible block
            5 - falling enemy            
    */
/*
Template
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],	
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
*/
var world1 = [
	//40 width
	//10 height
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 1, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7],
	[0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 1, 0, 0, 0, 0, 6, 0, 0, 0, 6, 0, 1, 0, 0, 0, 0, 6, 0, 0, 0],
	[0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 4, 4, 4, 4, 0, 9, 0, 0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
	[1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0]
	
];
    
var world2 = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0],
	[0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],
	[0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],
	[1, 1, 0, 0, 0, 0, 0, 0, 4, 1, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7],
	[1, 1, 4, 4, 1, 4, 1, 4, 1, 4, 4, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
];
    
var world3 = [
    [0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 4, 1, 0, 0, 0, 0, 0, 1, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0],
	[0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 4, 0, 0, 1, 1, 1, 4, 4, 4, 4, 4, 1, 0, 4, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],
	[0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 7],
	[0, 0, 0, 0, 1, 6, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 4, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 6, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0],
	[0, 0, 1, 1, 1, 0, 0, 0, 4, 0, 4, 6, 1, 0, 0, 0, 6, 4, 6, 4, 0, 1, 4, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 6, 0, 9, 0, 0, 6, 0, 0, 1, 0, 1, 0, 0],
	[1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 4, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
	[1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
];

var world4 = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],	
    [0, 0, 0, 1, 0, 0, 0, 4, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 1, 0, 1, 7],
    [0, 0, 0, 1, 6, 0, 6, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 4, 0, 0, 4, 4, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 0, 0, 1, 0, 1, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 6, 6, 6, 0, 1, 1, 6, 0, 1, 0, 0, 0, 0, 0, 0, 0, 6, 0, 3, 3, 1, 1, 3, 6, 1, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 0, 0, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4, 1, 1, 1, 3, 3, 3, 3, 1, 1, 6, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1],
];
    
var world5 = [
    [0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 4, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],	
    [0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 1, 0, 1, 2, 6, 0, 0, 1, 0, 1, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 3, 2, 2, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 2, 0, 0, 1, 3, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 1, 0, 1, 0, 1, 0, 6, 0, 0, 0, 0, 0],
    [0, 0, 0, 1, 0, 1, 0, 0, 6, 0, 1, 0, 1, 0, 0, 6, 0, 1, 0, 3, 0, 0, 2, 6, 0, 0, 1, 0, 0, 0, 0, 6, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 7],
    [0, 0, 0, 1, 2, 1, 1, 2, 2, 0, 1, 0, 0, 0, 4, 0, 0, 1, 0, 3, 4, 0, 0, 0, 0, 0, 1, 0, 6, 2, 0, 0, 4, 1, 1, 2, 2, 2, 2, 1, 3, 3, 3],
    [1, 1, 1, 1, 6, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 4, 1, 1, 0, 1, 1, 1, 0, 6, 0, 1, 1, 0, 0, 0, 0, 4, 1, 1, 1, 6, 6, 6, 0, 1, 3, 3, 3],
    [1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 3, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 3, 3, 3],
];
   //TODO
var world6 = [
    [0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 3, 3, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 6, 9, 0, 0, 9, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 6, 0, 2, 2, 2, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 3, 3, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 2, 1, 2, 1, 0, 0, 1, 1, 1, 3, 3, 3, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 6, 0, 0, 1, 0, 0, 0, 0, 0, 0, 6, 0, 1, 1, 1, 0, 0, 0, 1, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
];
    
var worldTest = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],	
    [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 9, 0, 1, 0, 0, 9, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
];
    
//put world into the world map
var mapWorlds = [world1, world2, world3, world4, world5];
var worldImgB = [];

    
var bound = [
	[],
	[],
	[],
	[],
	[],
	[],
	[],
	[],
	[],
	[]
];


    
class Player {
    constructor(x, y, width, height, speed, src) {
        this.width = width;
        this.height = height;
        this.x = x;
        this.y = y;
        this.speed = speed;
        this.velX = 0;
        this.velY = 0;
        this.jumping = false;
        this.grounded = false;
        this.move = true;
        this.win = false;
        this.coins = 0;
        this.src = src;
        this.img = new Image();
        this.img.src = src;
    }
};
    
class Enemy {
    constructor(x, y, xLBound, offSet) {
        this.x = x;
        this.y = y;
        //not changing
        this.noChangeX = x;
        this.orgX = x;
        //how far the enemy gets to move
        this.offSet = offSet;
        this.xLBound = xLBound;
        this.xRBound = xLBound + offSet;
        
        this.width = 50;
        this.height = 50;
        this.speed = 2;
        this.velX = 0;
        this.type = enemyT;
        
    }
}

class TrollBlock {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.width = 50; 
        this.height = 50;
        this.type = troll;
    }
}
    
    
class InvisibleBlock {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.width = 50;
        this.height = 50;
        this.type = iBlock;
        this.isTouched = false;
    }
}

class FallingEnemy {
    constructor(x, y, range) {
        this.x = x;
        this.y = y;
        this.width = 50;
        this.height = 50;
        this.type = fEnemy;
        this.range = range;
    }
}

var enemyArr = [];

var gravity = 0.3;
var friction = 0.9;

var pause = true;

var box = 1;
var spike = 2;
var air = 3;
var finish = 4;
var coin = 5;
var enemyT = 6;
var troll = 7;
var iBlock = 8;
var fEnemy = 9;
    
var tCoins = [];
var coinInWorld = [10, 12];
var started = false;
//var lose = false;
//var win = false;


class TextT {
    constructor(word, font, color, x, y) {
        this.word = word;
        //EX bold 12pt Arial
        this.font = font;
        this.color = color;
        this.x = x;
        this.y = y;
    }
}    
//holds all the text
var tArray = [];
//holds the text to draw
var tDrawArr = [];
    
var keys = [];
    
var menuImg = [];
var drawMenu = [];
    
var state;
var menuS = 0;
var gameS = 1;
    

class Img {
    constructor(src, x, y, width, height, callback) {
        this.img = new Image();
        this.src = src;
        this.img.src = this.src;
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        
        this.onclick = function() {
            callback && callback();
        }
    }
}
    
var playerGame;
var twoPlayer = 0;
var onePlayer = 1;
    
var playerONE = new Player(50, 350, 50, 50, 3, "http://www.clker.com/cliparts/X/9/P/m/2/g/transparent-red-circle-md.png");
var playerTWO = new Player(50, 350, 50, 50, 3, "http://www.clker.com/cliparts/W/i/K/w/1/D/glossy-orange-circle-icon-md.png");
    
var onePointText = new TextT("Player 1 Points: ", "10pt Arial", "red", 50, 50);
var twoPointText = new TextT("Player 2 Points: ", "10pt Arial", "red", 300, 50);

var ongoingTouches = [];
	
function init() {
    document.getElementById("myCanvas").addEventListener("mousemove", mouseMove);
	document.getElementById("myCanvas").addEventListener("mousedown", mouseDown);
    menu();
    
    onTick();
    perSec();
    if (isMobile()) {
        window.addEventListener("touchstart", touchStart, false);
        window.addEventListener("touchend", touchEnd, false)
    }
    
} 
    
function touchStart(e) {
    e.preventDefault();
      var el = document.getElementsByTagName("myCanvas")[0];
      var ctx = el.getContext("2d");
      var touches = evt.changedTouches;

      for (var i = 0; i < touches.length; i++) {
        println("touchstart:" + i + "...", "black");
        ongoingTouches.push(copyTouch(touches[i]));
        var color = colorForTouch(touches[i]);
        ctx.beginPath();
        ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0, 2 * Math.PI, false);  // a circle at the start
        ctx.fillStyle = color;
        ctx.fill();
        println("touchstart:" + i + ".", "black");
      }
}
    
    
    
function isMobile() {
  var check = false;
  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
  return check;
};
    
function menu() {
    window.addEventListener("keydown", null);
	window.addEventListener("keyup", null);
    state = menuS;
    
    var singleB = new Img("https://dabuttonfactory.com/button.png?t=1+Player&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=5&bgt=gradient&bgc=00f&ebgc=073763", 50, 200, 150, 50, function() {
        playerGame = onePlayer;
        //remove the two buttons
        drawMenu.splice(0, 2);
        setTimeout(function() {displayWorldLvl();}, 500);
    });
    
    var doubleB = new Img("https://dabuttonfactory.com/button.png?t=2+Player&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=5&bgt=gradient&bgc=00f&ebgc=073763", 300, 200, 150, 50, function() {
        playerGame = twoPlayer;
        drawMenu.splice(0, 2);
        setTimeout(function() {displayWorldLvl();}, 500);
    });
    
    menuImg.push(singleB);
    drawMenu.push(singleB);
    menuImg.push(doubleB);
    drawMenu.push(doubleB);
    
}
    
function displayWorldLvl() {
    //display maps
    //world1 button
    var world1B = new Img("https://dabuttonfactory.com/button.png?t=World+1&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=6&bgt=gradient&bgc=c00&ebgc=cfe2f3", 50, 100, 150, 50, function() {
        worldNum = 1;
        drawMenu.splice(0, drawMenu.length);
        startGame();
    });
    //world2 button
    var world2B = new Img("https://dabuttonfactory.com/button.png?t=World+2&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=5&bgt=gradient&bgc=f90&ebgc=3d85c6", 300, 100, 150, 50, function() {
        worldNum = 2;
        drawMenu.splice(0, drawMenu.length);
        startGame();
    });
    //world3 button
    var world3B = new Img("https://dabuttonfactory.com/button.png?t=World+3&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=5&bgt=gradient&bgc=52243b&ebgc=b6d7a8", 50, 200, 150, 50, function() {
        worldNum = 3;
        drawMenu.splice(0, drawMenu.length);
        startGame();
    });
    //world 4 button
    var world4B = new Img("https://dabuttonfactory.com/button.png?t=World+4&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=5&bgt=gradient&bgc=f0f&ebgc=e06666", 300, 200, 150, 50, function() {
        worldNum = 4;
        drawMenu.splice(0,drawMenu.length);
        startGame();
    });
    //world 5 button
    var world5B = new Img("https://dabuttonfactory.com/button.png?t=World+5&f=Calibri-Bold&ts=24&tc=fff&tshs=1&tshc=000&hp=20&vp=8&c=5&bgt=gradient&bgc=f1c232&ebgc=8e7cc3", 50, 300, 150, 50, function() {
        worldNum = 5;
        drawMenu.splice(0, drawMenu.length);
        startGame();
    });
    
    worldImgB.push(world1B); drawMenu.push(world1B);
    worldImgB.push(world2B); drawMenu.push(world2B);
    worldImgB.push(world3B); drawMenu.push(world3B);
    worldImgB.push(world4B); drawMenu.push(world4B);
    worldImgB.push(world5B); drawMenu.push(world5B);
}    
    
function resetPlayer(player) {
    player.x = 50;
    player.y = 350;
    player.velX = 0;
    player.velY = 0;
    player.jumping = false;
    player.grounded = false;
    player.move = true;
    player.win = false;
    player.coins = 0;
}
    
function startGame() {
    //console.log("ASDFAD");
    println("", "black");
    printlnLeaderboard("", "black");
    state = gameS;
    println("IMPORTANT!!! Make sure everytime you lose or win,", "black");
    println("press space after the text", "black");
	println("Player One, use WASD to move", "black");
    
    if (playerGame == twoPlayer) {
        println("Player Two, use ARROW keys to move", "black");
    }
    
    data(worldNum);
	
	
	window.addEventListener("keydown", keyDown);
	window.addEventListener("keyup", keyUp); 
	
    //playerGame = twoPlayer; 
    
	var world = mapWorlds[worldNum-1];
    //console.log(worldNum);
	for (var i = 0; i < world.length; i++) {
		for (var j = 0; j < world[i].length; j++) {
            var xpos = j*50;
            var ypos = i*50;
            var w = 50;
            var h = 50;
                
			if (world[i][j] == 1) {

				bound[i].push({
					x: xpos,
					y: ypos,
					width: w,
					height: h,
					type: box
				});
			} else if (world[i][j] == 4) {
				bound[i].push({
					x: xpos,
					y: ypos,
					width: w,
					height: h,
					type: spike
				});
			} else if (world[i][j] == 7) {
               bound[i].push({
                   x: xpos,
                   y: ypos,
                   width: w,
                   height: h,
                   type: finish
               });
            } else if (world[i][j] == 6) {
                bound[i].push({
                    x: xpos,
                    y: ypos,
                    width: w,
                    height: h,
                    type: coin
                });
                //console.log(xpos);
            } else if (world[i][j] == 9) {
                //enemy
                var e = new Enemy(xpos, ypos, xpos, 4*50);
                bound[i].push(e);
               // console.log(xpos + " " + (xpos + 4*50) + " " + player.x);
                enemyArr.push(e);
            } else if (world[i][j] == 3) {
                var t = new TrollBlock(xpos, ypos);
                bound[i].push(t);
            } else if (world[i][j] == 2) {
                var b = new InvisibleBlock(xpos, ypos);
                bound[i].push(b);                
            } else if (world[i][j] == 5) {
                var f = new FallingEnemy(xpos, ypos, 50*2);
                bound[i].push(b);
            }
            else {
				bound[i].push({
					type: air
				});
			}
		}
	}
	
    
    //displayText("World " + worldNum, "bold 20pt Arial", "black", 100, 100);
    //displayText("Map By: " + worldCreator[worldNum-1], "bold 15pt Arial", "black", 50, 150);
}

function mouseDown(e) {
    //console.log("MOUSE DOWN");
    for (var i = 0; i < drawMenu.length; i++) {
        var t = drawMenu[i];
        if (pointRectangle(e.x, e.y, t.x, t.y, t.width, t.height)) {
            t.onclick();
        }
    }
}
            
function pointRectangle(x1, y1, x2, y2, width, height) {
    if (x1 >= x2 && x1 <= x2 + width && y1 >= y2 && y1 <= y2 + height) {
        return true;
    }
    return false;
}            

function mouseMove(e) {

}

function keyUp(e) {
	keys[e.keyCode] = false;
}

function keyDown(e) {
    //console.log(started);
    if (started == false) {
            pause = false;
            started = true;
            keys[87] = false;
            keys[68] = false;
            keys[65] = false;
    }
	keys[e.keyCode] = true;
	
	if (keys[80]) {
        //P
		pause = !pause;
		//console.log("pause: " + pause);
	}
    
    if (keys[32]) {
        //SPACE 
        if (pause) {
            if (playerONE.win || playerTWO.win || (playerTWO.win == false && playerONE.win == false)) {
                //console.log("REset");
                resetGame();
            }
        }
    }
}
	
	
function onTick() {
	window.setTimeout(onTick, 20);
	
	drawScreen();
    //printWorldLevel(false);
    if (started) {
        tDrawArr.splice(0, 2);
    }
}
	
function perSec() {

	window.setTimeout(perSec, 1000);
	
	//startM++;
	//endM++;
}
    
function displayText(word, font, color, x, y) {
    var t = new TextT(word, font, color, x, y);
    tArray.push(t);
    tDrawArr.push(t);
}  

function colCheck(shapeA, shapeB, isIBlock) {
    isIBlock = isIBlock || false;
    // get the vectors to check against
    var vX = (shapeA.x + (shapeA.width / 2)) - (shapeB.x + (shapeB.width / 2));
    var vY = (shapeA.y + (shapeA.height / 2)) - (shapeB.y + (shapeB.height / 2));
        // add the half widths and half heights of the objects
    var hWidths = (shapeA.width / 2) + (shapeB.width / 2);
    var hHeights = (shapeA.height / 2) + (shapeB.height / 2);
    var colDir = null;
 
    // if the x and y vector are less than the half width or half height, they we must be inside the object, causing a collision
    if (Math.abs(vX) < hWidths && Math.abs(vY) < hHeights) {         // figures out on which side we are colliding (top, bottom, left, or right)        
		var oX = hWidths - Math.abs(vX);         
		var oY = hHeights - Math.abs(vY);         
		if (oX >= oY) {
			if (vY > 0) {
				colDir = "t";
				shapeA.y += oY;
			} else {
				colDir = "b";
				if (!isIBlock) shapeA.y -= oY;
			}
		} else {
			if (vX > 0) {
				colDir = "l";
				if (!isIBlock) shapeA.x += oX;
			} else {
				colDir = "r";
				if (!isIBlock)shapeA.x -= oX;
			}
		}
	}
    return colDir;
}

function checkSpike(triangle, player) {
	//TODO
	/*
			A
			*
		   / \
		  /	  \
		B *----* C
		y = mx + b
	*/
	//Slope of AB (m)
	var a = {
		x: triangle.x + triangle.width/2,
		y: triangle.y
	};
	
	var b = {
		x: triangle.x,
		y: triangle.y + triangle.height
	};
	
	var c = {
		x: triangle.x + triangle.width,
		y: triangle.y + triangle.height
	};
	
	var ab = {
		x: triangle.width/4 + b.x,
		y: triangle.height/2 + a.y
	};
	
	var ac = {
		x: triangle.width/4 + a.x,
		y: triangle.height/2 + a.y
	};
	
	//console.log(a.x + " " + a.y);  
	//console.log(b.x + " " + b.y);
	//console.log(c.x + " " + c.y);
	
	var rad = player.width/2;
	
	var x = Math.floor(player.x) + player.width/2;
	var y = Math.floor(player.y) + player.height/2;
	
	var aD = Math.floor((a.x - x) * (a.x - x) + (a.y - y) * (a.y - y));
	var bD = Math.floor((b.x - x) * (b.x - x) + (b.y - y) * (b.y - y));
	var cD = Math.floor((c.x - x) * (c.x - x) + (c.y - y) * (c.y - y));
	var abD = Math.floor((ab.x - x) * (ab.x - x) + (ab.y-y)*(ab.y-y));
	var acD = Math.floor((ac.x - x) * (ac.x - x) + (ac.y-y)*(ac.y-y));
	
	var rad2 = rad * rad;
	
	if (aD <= rad2 || bD <= rad2 || cD <= rad2 || abD <= rad2 || acD <= rad2) {
		return true;
	
	}
    return false;
}

function circleCol(c1, c2) {
    var r1 = c1.width/2;
    var x1 = c1.x;
    var y1 = c1.y;
    
    var r2 = c2.width/2;
    var x2 = c2.x;
    var y2 = c2.y;
    
    var dis = (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2);
    //assuming r1 == r2
    var r3 = r1 + r2;
    if (dis < (r3 * r3)) {
        return true;
    }
    return false;
}

function gameWin() {
    pause = true;
    println("Nice You Finished! Want to make a map of your own?", "purple");
    println("Talk to the creator for details. (Credit will go to you)", "purple"); 
    println("(SPACE to continue)", "purple");
    win = true;
}
    
function gameOver() {
    pause = true;
    lose = true;
    println("LOSE! Press SPACE to continue", "red");
}
    
function resetGame() {
    println("");
    println("");
    
    var tPoints = playerONE.coins;
    
    var p1coins = playerONE.coins;
    var p2coins = playerTWO.coins;
    
    var win1 = playerONE.win;
    var win2 = playerTWO.win;
    
    if (playerGame == twoPlayer) {
        tPoints = Math.max(p1coins, p2coins);
    }
    
    
    
    resetPlayer(playerONE);
    
    
    if (playerGame == twoPlayer) {
        resetPlayer(playerTWO);
    }
    
    pause = true;
    started = false;
    
   
    countSpeed = 0;
    
    
    for (var i = 0; i < bound.length; i++) {
        for (var j = 0; j < bound[i].length; j++) {
            if (bound[i][j].type == iBlock) bound[i][j].isTouched = false;
                
            bound[i][j].x = bound[i][j].noChangeX;
            bound[i][j].orgX = bound[i][j].noChangeX;
            //console.log(bound.orgX);
        }
    }
    
    for (var i = 0; i < tCoins.length; i++) {
        var t1 = tCoins[i][0];
        var t2 = tCoins[i][1];
        //console.log(t1 + " " + t2);
        bound[t2][t1] = {
            x: t1*50,
            y: t2*50,
            width: 50,
            height: 50,
            type: coin
        };
        mapWorlds[worldNum-1][t2][t1] = 6;
    }
    
   //console.log(win1 + " " + win2);
     if (win1 == false && win2 == false) {
        println("You got " + (p1coins + p2coins) + " point(s)!", "blue");
        println("ooo... you have to reach the end to be on the leaderboard...", "brown");
        println("Press SPACE to retry", "red");
    } else {
        //console.log(name)
        println("Congrats! You reached the end!", "red");
        if (playerGame == twoPlayer) {
            println("The most points a player got was " + tPoints + " point(s)!", "blue");
        } else {
            println("You got " + tPoints + " point(s)!", "blue");
        }
        
        
        setTimeout(function() {
            var name = prompt("Type your name in here to be on the leaderboard! (Make sure your name isn't the same as someone on the leaderboard!) ")
            
            if (name.replace(/\s/g, '') == "" || name == null) {
                alert("... okay anonymous...not putting you on the leaderboard...");
            } else {
                //add into firebase
                 name = name.trim();
                addToLeaderboard(name, tPoints, worldNum);
            }
            println("Press SPACE to retry", "red");
        }, 1000);
    }
    
    println("");
    println("");
}
    
	function drawScreen() {
		var canvas = document.getElementById("myCanvas");
		var context = canvas.getContext("2d");
		var height = canvas.height;
		var width = canvas.width;
		var div = document.getElementById("myDiv");
		var width = canvas.width;
		var height = canvas.height;
        //console.log(state);
       printWorldLevel();
        
        context.clearRect(0, 0, 500, 500);
        //border around canvas
        context.fillStyle = "#ffffff";
        context.fillRect(0, 0, canvas.width, canvas.height);

        context.strokeStyle = "#000000";
        context.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
        
		if (state == gameS) {
            //console.log("ASDFA");
            //console.log(player.velY);
            if (!pause) {
                //player one controls
                 if (keys[87]) {
                     //console.log("UP");
                    // up arrow or space
                  if(!playerONE.jumping){
                   playerONE.jumping = true;
                   playerONE.velY = -playerONE.speed*2;
                  }
                }
                if (keys[68]) {
                    // right arrow
                    if (playerONE.velX < playerONE.speed) {             
                        playerONE.velX++;         
                     }     
                }     
                if (keys[65]) {         
                    // left arrow         
                    if (playerONE.velX > -playerONE.speed) {
                        playerONE.velX--;
                    }
                }
                
                if (playerGame == twoPlayer) {
                    //player two controls
                    if (keys[38]) {
                        if(!playerTWO.jumping){
                           playerTWO.jumping = true;
                           playerTWO.velY = -playerTWO.speed*2;
                        }
                    } 
                    if (keys[37]) {
                        if (playerTWO.velX > -playerTWO.speed) {
                            playerTWO.velX--;
                        }
                    }
                    if (keys[39]) {
                        if (playerTWO.velX < playerTWO.speed) {             
                            playerTWO.velX++;         
                        } 
                    }
                }


                playerONE.velX *= friction;

                playerONE.velY += gravity;

                playerONE.x += playerONE.velX;
                playerONE.y += playerONE.velY;
                
                if (Math.trunc(playerONE.velX) == 0) {
                    playerONE.move = false;

                } else{
                    playerONE.move = true;
                }

                if (playerONE.x >= width-playerONE.width) {
                    playerONE.x = width-playerONE.width;
                } else if (playerONE.x <= 0) {  
                    //GAMEOVER
                    //player touches the back
                    playerONE.x = 0;   
                    //console.log("LOSE");
                    gameOver();
                }    

                //falls down into hole
                if(playerONE.y >= height){

                    //GAMEOVER
                    gameOver();
                } 

                playerONE.grounded = false;
                
                if (playerGame == twoPlayer) {
                    playerTWO.velX *= friction;
                    playerTWO.velY += gravity;
                    
                    playerTWO.x += playerTWO.velX;
                    playerTWO.y += playerTWO.velY;
                    
                    if (Math.trunc(playerTWO.velX) == 0) {
                        playerTWO.move = false;

                    } else{
                        playerTWO.move = true;
                    }

                    if (playerTWO.x >= width-playerTWO.width) {
                        playerTWO.x = width-playerTWO.width;
                    } else if (playerTWO.x <= 0) {  
                        //GAMEOVER
                        //player touches the back
                        playerTWO.x = 0;   
                        //console.log("LOSE");
                        gameOver();
                    }    

                    //falls down into hole
                    if(playerTWO.y >= height){

                        //GAMEOVER
                        gameOver();
                        /*
                        player.y = height - player.height;
                        //console.log("TOUCHED");
                        player.jumping = false;
                        */
                    } 

                    playerTWO.grounded = false;
                }
               




                

                if (countSpeed > 75) {
                    startM++;
                    endM++;
                    //console.log(startM);

                }

                for (var i = 0; i < bound.length; i++) {
                    for (var j = 0; j < bound[i].length; j++) {
                        if (bound[i][j] != null) {
                            //check if the boxes are in the canvas
                            var b = bound[i][j];
                            if(b.type == box && b.x < 600 && b.x > -100) {
                                var dir = colCheck(playerONE, b);
                                    
                                if (dir === "l" || dir === "r") {
                                    playerONE.velX = 0;
                                    playerONE.jumping = false;
                                } else if (dir === "b") {
                                    playerONE.grounded = true;
                                    playerONE.jumping = false;
                                } else if (dir === "t") {
                                    playerONE.velY *= -1;
                                }
                                
                                if (playerGame == twoPlayer) {
                                    var dir2 = colCheck(playerTWO, b);
                                    
                                    if (dir2 === "l" || dir2 === "r") {
                                        playerTWO.velX = 0;
                                        playerTWO.jumping = false;
                                    } else if (dir2 === "b") {
                                        playerTWO.grounded = true;
                                        playerTWO.jumping = false;
                                    } else if (dir2 === "t") {
                                        playerTWO.velY *= -1;
                                    }
                                }
                            
                            } else if (b.type == spike && b.x < 600 && b.x > -100) {
                                if (checkSpike(b, playerONE)) {
                                    //console.log("Touced spike");
                                    gameOver();
                                }
                                
                                if (playerGame == twoPlayer) {
                                    if (checkSpike(b, playerTWO)) {
                                        gameOver();
                                    }
                                }
                            } else if (b.type == finish) {
                                var dir = colCheck(playerONE, b);

                                if (dir != null) {
                                    playerONE.win = true;
                                    gameWin();
                                }
                                
                                if (playerGame == twoPlayer && colCheck(playerTWO, b) != null) {
                                    playerTWO.win = true;
                                    gameWin();
                                }
                                
                                
                            } else if (b.type == coin) {
                                if (circleCol(playerONE, b)) {
                                    //points++;
                                    bound[i][j] = {
                                        type: air
                                    }
                                    
                                    mapWorlds[worldNum-1][i][j] = 0;
                                    //stores the "touched" coin into an array so it can be put back into the game after reset

                                    tCoins.push(new Array(j, i));
                                    playerONE.coins++;
                                    
                                } else {
                                
                                    if (playerGame == twoPlayer && circleCol(playerTWO, b)) {
                                        bound[i][j] = {
                                            type: air
                                        }

                                        mapWorlds[worldNum-1][i][j] = 0;
                                        //stores the "touched" coin into an array so it can be put back into the game after reset

                                        tCoins.push(new Array(j, i));
                                        playerTWO.coins++;
                                    }
                                }
                            } else if (b.type == enemyT) {
                                if (circleCol(playerONE, b)) {
                                    gameOver();
                                }
                                if (playerGame == twoPlayer && circleCol(playerTWO, b)) {
                                    gameOver();
                                }
                            } else if (b.type == troll && b.x < 600 && b.x > -100) {
                                //if player touches it, they fall immediately.  They can still wall climb 
                                if (playerONE.x +playerONE.width/2 > b.x && playerONE.x + playerONE.width/2 < b.x + b.width) {
                                    if (playerONE.y + playerONE.height+1 > b.y && playerONE.y + playerONE.height < b.y+b.height/2) {
                                        playerONE.grounded = false;
                                        playerONE.jumping = true;
                                    }
                                }
                                if (playerGame == twoPlayer) {
                                    if (playerTWO.x +playerTWO.width/2 > b.x && playerTWO.x + playerTWO.width/2 < b.x + b.width) {
                                        if (playerTWO.y + playerTWO.height+1 > b.y && playerTWO.y + playerTWO.height < b.y+b.height/2) {
                                            playerTWO.grounded = false;
                                            playerTWO.jumping = true;
                                        }
                                    }
                                }
                            } else if (b.type == iBlock) {
                                if (b.x < 600 && b.x > -100) {
                                    
                                    if (b.isTouched) {
                                        var dir = colCheck(playerONE, b, false);
                                        if (dir === "l" || dir === "r") {
                                            playerONE.velX = 0;
                                            playerONE.jumping = false;
                                        } else if (dir === "b") {
                                            playerONE.grounded = true;
                                            playerONE.jumping = false;
                                        } else if (dir === "t") {
                                            playerONE.velY *= -1;
                                        }
                                    } else {
                                        var dir = colCheck(playerONE, b, true);
                                        if (dir == "t") {
                                            b.isTouched = true;
                                            playerONE.velY *= -1;
                                        }
                                    }
                                    if (playerGame == twoPlayer) {
                                        if (b.isTouched) {
                                            var dir = colCheck(playerTWO, b, false);
                                            if (dir === "l" || dir === "r") {
                                                playerTWO.velX = 0;
                                                playerTWO.jumping = false;
                                            } else if (dir === "b") {
                                                playerTWO.grounded = true;
                                                playerTWO.jumping = false;
                                            } else if (dir === "t") {
                                                playerTWO.velY *= -1;
                                            }
                                        } else {
                                            var dir = colCheck(playerTWO, b, true);
                                            if (dir == "t") {
                                                b.isTouched = true;
                                                playerTWO.velY *= -1;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

                if(playerONE.grounded){
                     playerONE.velY = 0;
                }
                
                if (playerGame == twoPlayer && playerTWO.grounded) {
                    playerTWO.velY = 0;
                }
            }



            


            var world = mapWorlds[worldNum-1];
            for (var i = 0; i < world.length; i++) {
                for (var j = 0; j < world[i].length; j++) {

                    var img = new Image();
                    var pix = world[i][j];

                    var x = j*50-countSpeed;
                    var y = i*50;
                    
                    if (pix == 1) {
                        if (x < 600 && x > -100) {
                            //blocks
                            img.src = "https://i.stack.imgur.com/ZcPaO.png";
                            context.drawImage(img, x, y, 50, 50);
                        }
                        bound[i][j].x = x;
                    } else if (pix == 4) {
                        if (x < 600 && x > -100) {
                            //spikes
                            img.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Green_equilateral_triangle_point_up.svg/886px-Green_equilateral_triangle_point_up.svg.png";
                            context.drawImage(img, x, y, 50, 50);
                        }
                        bound[i][j].x = x;
                    } else if (pix == 7) {
                        //finish paltform
                        img.src = "https://img.buzzfeed.com/buzzfeed-static/static/2016-02/5/12/enhanced/webdr10/enhanced-buzz-19784-1454693031-4.jpg";
                        context.drawImage(img, x, y, 50, 50);
                        bound[i][j].x = x;
                    } else if (pix == 6) {
                        //coin
                        if (x < 600 && x > -100) {
                            //coin
                            img.src = "http://rs1312.pbsrc.com/albums/t523/Super_Mario_Official/Collected%20Star%20Coin_zpsac55g8nr.gif~c200";
                            context.drawImage(img, x, y, 50, 50);
                        }
                        //console.log(pix);
                        bound[i][j].x = x;
                    } else if (pix == 9) {
                        //if (x < 600 && x > -100) {
                        //enemy
                        img.src = "http://www.wprvresort.com/index_htm_files/1015.png";

                        var e = bound[i][j];
                        var tempX = e.x;
                        var ex = e.orgX;
                        var lBound = e.xLBound;
                        var rBound = e.xRBound;
                        if (!pause) {
                            if (ex + e.velX > rBound || ex + e.velX < lBound) {
                                e.speed *= -1;
                            }
                            e.velX += e.speed;   



                            bound[i][j].orgX = x;
                            bound[i][j].xLBound = x;
                            bound[i][j].xRBound = x + e.offSet;
                            bound[i][j].x = ex + e.velX;
                        }
                        context.drawImage(img, ex + e.velX, y, 50, 50);
                        
                    }  else if (pix == 3) {
                        img.src = "https://i.stack.imgur.com/ZcPaO.png";
                        context.globalAlpha = 0.9;
                        //console.log("ASFASDF");
                        context.drawImage(img, x, y, 50, 50);
                        bound[i][j].x = x;
                        context.globalAlpha = 1;
                    } else if (pix == 2) {
                        img.src = "https://i.stack.imgur.com/ZcPaO.png";
                        var block = bound[i][j];
                        if (block.isTouched) context.globalAlpha = 1;
                        else context.globalAlpha = 0;
                        
                        context.drawImage(img, x, y, 50, 50);
                        context.globalAlpha = 1;
                        bound[i][j].x = x;
                    } else if (pix == 5) {
                        //TODO add or delete falling enemies
                        /*
                        img.src = "http://www.wprvresort.com/index_htm_files/1015.png";
                        if (bound[i][j].y > height + 100) context.drawImage(img, x, y, 50, 50);
                        bound[i][j].x = x;*/
                    }
                }
            }

            for (var i = 0; i < tDrawArr.length; i++) {
                var t = tDrawArr[i];
                context.fillStyle = t.color;
                context.font = t.font;
                context.fillText(t.word, t.x, t.y);
            }
            //displays points
            
            context.fillStyle = onePointText.color;
            context.font = onePointText.font;
            context.fillText(onePointText.word + playerONE.coins, onePointText.x, onePointText.y);
            
            if (playerGame == twoPlayer) {
                context.fillStyle = twoPointText.color;
                context.font = twoPointText.font;
                context.fillText(twoPointText.word + playerTWO.coins, twoPointText.x, twoPointText.y);
            }
            
            context.fillStyle = "black";
            
            if (!pause) {
                //console.log(player.move);
                if (playerONE.move == false) {
                    playerONE.x -= 1.5;
                }
                if (playerGame == twoPlayer && playerTWO.move == false) {
                    playerTWO.x -= 1.5;
                }
                //console.log(player.move);
                for (var i = 0; i < bound.length; i++) {
                    bound[i].x -= countSpeed;
                }
                countSpeed += 1.5;


            }

            //character
            context.drawImage(playerONE.img, playerONE.x, playerONE.y, playerONE.width, playerONE.height);
            if (playerGame == twoPlayer) {
                context.drawImage(playerTWO.img, playerTWO.x, playerTWO.y, playerTWO.width, playerTWO.height);
            }
            
            //console.log("1: " + playerONE.coins + " 2: " + playerTWO.coins);
            
        } else if (state == menuS) {
            for (var i = 0; i < drawMenu.length; i++) {
                var t = drawMenu[i];
                context.drawImage(t.img, t.x, t.y, t.width, t.height);
            }
        }
		
	}
	
	
	
	function println(words, color) {
		var console = document.getElementById("console");
		var linebr = document.createElement("br");
		var span = document.createElement('span');
		span.style.color = color;
		console.append(span);
		span.append(words);
		span.append(linebr);
		console.scrollTop += 50;
	}
    
    function printlnLeaderboard(words, color) {
		var cs = document.getElementById("leaderboard");
		var linebr = document.createElement("br");
		var span = document.createElement('span');
		span.style.color = color;
		cs.append(span);
		span.append(words);
		span.append(linebr);
		cs.scrollTop += 50;
	}
    
    //prints out the world level and creator onto a canvas
    function printWorldLevel() {
        var canvasL = document.getElementById("worldC");
		var contextL = canvasL.getContext("2d");
        
        contextL.clearRect(0, 0, canvasL.width, canvasL.height);
        
        contextL.fillStyle = "#ffffff";
        contextL.fillRect(0, 0, canvasL.width, canvasL.height);
        
        contextL.strokeStyle = "#000000";
        contextL.strokeRect(1, 1, canvasL.width - 2, canvasL.height - 2);
        
        
        if (state == gameS) {
            //console.log("ASDFASDF");
            contextL.fillStyle = "black";
            contextL.font = "30pt Arial";
            contextL.fillText("World " + worldNum, 10, (canvasL.height+25) / 2);

            contextL.font = "20pt Arial";
            contextL.fillText("Map By : " + worldCreator[worldNum-1], canvasL.width / 3, (canvasL.height+25) / 2);
        } else if (state == menuS) {
            contextL.fillStyle = "black";
            contextL.font = "30pt Arial";
            //displays title
            contextL.fillText("Rip-off Mario", (canvasL.width-250) / 2, (canvasL.height+25) / 2);
        }
    }
    
	
	


</script>
</head>
<body onload="init()" >


<table>
<tr height="80%">
<td width="50%">
<div id="myDiv">
<canvas id="myCanvas" width="500" height="500">
Your browser does not support the HTML5 canvas tag.
</canvas></div></td>


<td width="50%">
    <table>
            <tr height="75%">
                <div id="div2" style="text-align: left" >
                    <pre id="console">
                    </pre>
                </div>
        </tr>
        
        <tr height="25%">
            <div id="div3" style="text-align: left">
                <pre id="leaderboard">
                </pre>
            </div>
        </tr>
    </table>
</td>
</tr>
</table>
 

<div id="worldDIV" width="500" height="100">
        <canvas id="worldC" width="500" height="100">
        
        </canvas>
</div>

</body>
</html>
